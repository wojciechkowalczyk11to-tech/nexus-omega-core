<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Omega | Advanced AI Interface</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gray: {
                            750: '#2d3748',
                            850: '#1a202c',
                            950: '#0d1117',
                        },
                        primary: {
                            500: '#3b82f6',
                            600: '#2563eb',
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Markdown Rendering (Marked) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Code Highlighting (Prism) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>

    <!-- Icons (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        .markdown-body pre { background: #1e1e1e; padding: 1em; border-radius: 8px; overflow-x: auto; }
        .markdown-body code { font-family: 'Fira Code', monospace; font-size: 0.9em; }
        .markdown-body p { margin-bottom: 0.8em; line-height: 1.6; }
        .markdown-body ul { list-style-type: disc; margin-left: 1.5em; margin-bottom: 0.8em; }
        .markdown-body ol { list-style-type: decimal; margin-left: 1.5em; margin-bottom: 0.8em; }
        .markdown-body h1 { font-size: 1.8em; font-weight: bold; margin-top: 1em; margin-bottom: 0.5em; }
        .markdown-body h2 { font-size: 1.5em; font-weight: bold; margin-top: 1em; margin-bottom: 0.5em; }
        .markdown-body a { color: #3b82f6; text-decoration: underline; }
        
        .typing-indicator span {
            animation: blink 1.4s infinite both;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink { 0% { opacity: 0.2; transform: scale(0.8); } 20% { opacity: 1; transform: scale(1); } 100% { opacity: 0.2; transform: scale(0.8); } }
    </style>
</head>
<body class="bg-gray-950 text-gray-100 h-screen overflow-hidden flex selection:bg-primary-500/30">

    <div id="app" class="flex w-full h-full">
        <!-- Sidebar: History -->
        <!-- Mobile Overlay -->
        <div v-if="sidebarOpen" @click="sidebarOpen = false" class="fixed inset-0 bg-black/50 z-20 md:hidden"></div>

        <aside :class="['bg-gray-900 border-r border-gray-800 transition-all duration-300 flex flex-col absolute md:relative z-30 h-full', sidebarOpen ? 'w-64 translate-x-0' : 'w-64 -translate-x-full md:w-0 md:translate-x-0 md:overflow-hidden']">
            <div class="p-4 flex items-center justify-between border-b border-gray-800">
                <div class="flex items-center gap-2 font-bold text-lg text-primary-500">
                    <i data-lucide="zap"></i> Nexus Omega
                </div>
                <button @click="startNewChat" class="p-1 hover:bg-gray-800 rounded" title="New Chat">
                    <i data-lucide="plus-square" class="w-5 h-5 text-gray-400"></i>
                </button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-2 space-y-1">
                <div v-for="(chat, index) in history" :key="chat.id" 
                     @click="loadChat(chat.id)"
                     :class="['p-3 rounded-lg cursor-pointer text-sm truncate group flex justify-between items-center', activeChatId === chat.id ? 'bg-gray-800 text-white' : 'text-gray-400 hover:bg-gray-800/50 hover:text-gray-200']">
                    <span class="truncate">{{ chat.title }}</span>
                    <button @click.stop="deleteChat(chat.id)" class="opacity-0 group-hover:opacity-100 hover:text-red-400">
                        <i data-lucide="trash-2" class="w-3 h-3"></i>
                    </button>
                </div>
            </div>

            <div class="p-4 border-t border-gray-800">
                <div class="flex items-center gap-3 px-2 py-2 rounded hover:bg-gray-800 cursor-pointer">
                    <img src="https://ui-avatars.com/api/?name=User&background=random" class="w-8 h-8 rounded-full">
                    <div class="text-sm">
                        <div class="font-medium">Admin User</div>
                        <div class="text-xs text-gray-500">Pro Plan</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="flex-1 flex flex-col relative min-w-0">
            <!-- Top Bar -->
            <header class="h-14 border-b border-gray-800 flex items-center justify-between px-4 bg-gray-950/80 backdrop-blur z-10">
                <div class="flex items-center gap-3">
                    <button @click="sidebarOpen = !sidebarOpen" class="text-gray-400 hover:text-white">
                        <i data-lucide="menu" class="w-5 h-5"></i>
                    </button>
                    <div class="flex items-center gap-2 px-3 py-1 bg-gray-800 rounded-full text-xs font-medium cursor-pointer hover:bg-gray-700" @click="showModelSelector = !showModelSelector">
                        <span>{{ currentModel }}</span>
                        <i data-lucide="chevron-down" class="w-3 h-3"></i>
                    </div>
                </div>
                
                <div class="flex items-center gap-3">
                    <button @click="showArtifacts = !showArtifacts" :class="['p-2 rounded hover:bg-gray-800', showArtifacts ? 'text-primary-500' : 'text-gray-400']" title="Toggle Artifacts">
                        <i data-lucide="layout" class="w-5 h-5"></i>
                    </button>
                    <button class="p-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded">
                        <i data-lucide="settings" class="w-5 h-5"></i>
                    </button>
                </div>
            </header>

            <!-- Model Selector Dropdown -->
            <div v-if="showModelSelector" class="absolute top-14 left-14 w-64 bg-gray-900 border border-gray-700 rounded-lg shadow-xl z-50 p-1">
                <div v-for="model in models" :key="model.id" 
                     @click="currentModel = model.name; showModelSelector = false"
                     class="px-4 py-2 hover:bg-gray-800 rounded cursor-pointer text-sm flex justify-between items-center">
                    <div>
                        <div class="font-medium text-gray-200">{{ model.name }}</div>
                        <div class="text-xs text-gray-500">{{ model.desc }}</div>
                    </div>
                    <i v-if="currentModel === model.name" data-lucide="check" class="w-4 h-4 text-primary-500"></i>
                </div>
            </div>

            <!-- Messages Area -->
            <div ref="messagesContainer" class="flex-1 overflow-y-auto p-4 md:p-8 space-y-6 scrollbar-hide scroll-smooth">
                <div v-if="messages.length === 0" class="flex flex-col items-center justify-center h-full text-center space-y-4">
                    <div class="w-16 h-16 bg-gray-800 rounded-2xl flex items-center justify-center mb-4">
                        <i data-lucide="zap" class="w-8 h-8 text-gray-400"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-white">How can I help you today?</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 w-full max-w-2xl mt-8">
                        <button @click="setInput('Analyze this CSV file for anomalies')" class="p-4 bg-gray-900 border border-gray-800 rounded-xl hover:bg-gray-800 text-left text-sm transition text-gray-400 hover:text-gray-200">
                            Analyze this CSV file for anomalies
                        </button>
                        <button @click="setInput('Create a React component for a dashboard')" class="p-4 bg-gray-900 border border-gray-800 rounded-xl hover:bg-gray-800 text-left text-sm transition text-gray-400 hover:text-gray-200">
                            Create a React component for a dashboard
                        </button>
                        <button @click="setInput('Explain quantum entanglement simply')" class="p-4 bg-gray-900 border border-gray-800 rounded-xl hover:bg-gray-800 text-left text-sm transition text-gray-400 hover:text-gray-200">
                            Explain quantum entanglement simply
                        </button>
                        <button @click="setInput('Write a Python script to scrape a website')" class="p-4 bg-gray-900 border border-gray-800 rounded-xl hover:bg-gray-800 text-left text-sm transition text-gray-400 hover:text-gray-200">
                            Write a Python script to scrape a website
                        </button>
                    </div>
                </div>

                <div v-for="(msg, index) in messages" :key="index" :class="['flex gap-4 max-w-3xl mx-auto', msg.role === 'user' ? 'justify-end' : 'justify-start']">
                    <div v-if="msg.role === 'assistant'" class="w-8 h-8 rounded-full bg-primary-600 flex-shrink-0 flex items-center justify-center">
                        <i data-lucide="bot" class="w-5 h-5 text-white"></i>
                    </div>
                    
                    <div :class="['relative px-5 py-3 rounded-2xl text-sm leading-relaxed max-w-[85%]', 
                        msg.role === 'user' ? 'bg-gray-800 text-white rounded-br-none' : 'text-gray-100 rounded-bl-none w-full']">
                        
                        <div v-if="msg.role === 'user'">{{ msg.content }}</div>
                        <div v-else class="markdown-body" v-html="renderMarkdown(msg.content)"></div>
                        
                        <!-- Tool Execution Indicator -->
                        <div v-if="msg.tools && msg.tools.length" class="mt-3 space-y-2">
                            <div v-for="tool in msg.tools" class="flex items-center gap-2 text-xs bg-gray-900/50 p-2 rounded border border-gray-700/50">
                                <i data-lucide="terminal" class="w-3 h-3 text-green-400"></i>
                                <span class="font-mono text-gray-400">Used tool: {{ tool.name }}</span>
                                <span v-if="tool.status === 'success'" class="text-green-500 ml-auto text-[10px] uppercase">Success</span>
                            </div>
                        </div>
                    </div>

                    <div v-if="msg.role === 'user'" class="w-8 h-8 rounded-full bg-gray-700 flex-shrink-0 flex items-center justify-center">
                        <i data-lucide="user" class="w-5 h-5 text-gray-300"></i>
                    </div>
                </div>

                <div v-if="isTyping" class="flex gap-4 max-w-3xl mx-auto">
                    <div class="w-8 h-8 rounded-full bg-primary-600 flex-shrink-0 flex items-center justify-center">
                        <i data-lucide="bot" class="w-5 h-5 text-white"></i>
                    </div>
                    <div class="px-5 py-4 rounded-2xl rounded-bl-none bg-gray-900/50 flex items-center gap-1 typing-indicator">
                        <span class="w-2 h-2 bg-gray-500 rounded-full"></span>
                        <span class="w-2 h-2 bg-gray-500 rounded-full"></span>
                        <span class="w-2 h-2 bg-gray-500 rounded-full"></span>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-4 bg-gray-950 border-t border-gray-800">
                <div class="max-w-3xl mx-auto relative bg-gray-900 border border-gray-700 rounded-xl shadow-sm focus-within:ring-2 focus-within:ring-primary-500/50 focus-within:border-primary-500 transition-all">
                    <!-- File Upload Preview -->
                    <div v-if="attachments.length > 0" class="flex gap-2 p-2 border-b border-gray-800 overflow-x-auto">
                        <div v-for="(file, i) in attachments" :key="i" class="relative group bg-gray-800 p-2 rounded flex items-center gap-2 text-xs border border-gray-700">
                            <i data-lucide="file" class="w-3 h-3"></i>
                            <span class="max-w-[100px] truncate">{{ file.name }}</span>
                            <button @click="removeAttachment(i)" class="ml-1 hover:text-red-400"><i data-lucide="x" class="w-3 h-3"></i></button>
                        </div>
                    </div>

                    <textarea 
                        v-model="input" 
                        @keydown.enter.prevent="sendMessage"
                        placeholder="Message Nexus Omega..." 
                        class="w-full bg-transparent text-white p-3 max-h-48 min-h-[56px] resize-none focus:outline-none scrollbar-hide"
                        rows="1"
                        ref="textarea"
                    ></textarea>

                    <div class="flex items-center justify-between p-2">
                        <div class="flex items-center gap-1">
                            <button @click="$refs.fileInput.click()" class="p-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded transition-colors" title="Attach file">
                                <i data-lucide="paperclip" class="w-4 h-4"></i>
                            </button>
                            <input type="file" ref="fileInput" multiple class="hidden" @change="handleFileUpload">
                            
                            <button class="p-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded transition-colors" title="Web Search">
                                <i data-lucide="globe" class="w-4 h-4"></i>
                            </button>
                        </div>
                        
                        <button 
                            @click="sendMessage" 
                            :disabled="!input.trim() && attachments.length === 0"
                            :class="['p-2 rounded-lg transition-all', input.trim() ? 'bg-primary-600 text-white shadow-lg shadow-primary-500/20 hover:bg-primary-500' : 'bg-gray-800 text-gray-500 cursor-not-allowed']">
                            <i data-lucide="arrow-up" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
                <div class="text-center mt-2 text-xs text-gray-600">
                    Nexus Omega can make mistakes. Check important info.
                </div>
            </div>
        </main>

        <!-- Artifacts Panel (Right Side) -->
        <div v-if="showArtifacts" class="w-[400px] border-l border-gray-800 bg-gray-900 flex flex-col transition-all duration-300">
            <div class="p-3 border-b border-gray-800 flex items-center justify-between bg-gray-850">
                <span class="text-xs font-semibold uppercase tracking-wider text-gray-400">Artifacts</span>
                <button @click="showArtifacts = false" class="text-gray-500 hover:text-white"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>
            <div class="flex-1 p-4 overflow-y-auto">
                <div v-if="!currentArtifact" class="h-full flex flex-col items-center justify-center text-gray-500 text-sm">
                    <i data-lucide="code" class="w-8 h-8 mb-2 opacity-50"></i>
                    <p>No active artifacts.</p>
                    <p class="text-xs mt-1">Generate code to see it here.</p>
                </div>
                <div v-else class="bg-white rounded-lg h-full overflow-hidden shadow-lg border border-gray-700">
                    <div class="bg-gray-100 p-2 border-b flex justify-between items-center px-4">
                        <span class="text-xs text-gray-500 font-mono">preview.html</span>
                        <div class="flex gap-1">
                            <div class="w-2 h-2 rounded-full bg-red-400"></div>
                            <div class="w-2 h-2 rounded-full bg-yellow-400"></div>
                            <div class="w-2 h-2 rounded-full bg-green-400"></div>
                        </div>
                    </div>
                    <iframe :srcdoc="currentArtifact" class="w-full h-full bg-white border-0"></iframe>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted, nextTick, watch } = Vue;

        createApp({
            setup() {
                const input = ref('');
                const messages = ref([]);
                const isTyping = ref(false);
                const sidebarOpen = ref(true);
                const showArtifacts = ref(false);
                const currentArtifact = ref(null);
                const messagesContainer = ref(null);
                const attachments = ref([]);
                const showModelSelector = ref(false);
                const currentModel = ref('Claude 3.5 Sonnet');
                
                const models = [
                    { id: 'claude', name: 'Claude 3.5 Sonnet', desc: 'Most intelligent' },
                    { id: 'gpt4', name: 'GPT-4 Turbo', desc: 'Fast & capable' },
                    { id: 'gemini', name: 'Gemini Pro 1.5', desc: 'Large context' },
                ];

                const history = ref([
                    { id: 1, title: 'Project Architecture Review' },
                    { id: 2, title: 'Python Async/Await Help' },
                    { id: 3, title: 'Database Schema Design' },
                ]);
                const activeChatId = ref(1);

                // Auto-resize textarea
                const textarea = ref(null);
                watch(input, () => {
                    nextTick(() => {
                        if (textarea.value) {
                            textarea.value.style.height = 'auto';
                            textarea.value.style.height = textarea.value.scrollHeight + 'px';
                        }
                    });
                });

                const scrollToBottom = () => {
                    nextTick(() => {
                        if (messagesContainer.value) {
                            messagesContainer.value.scrollTop = messagesContainer.value.scrollHeight;
                        }
                    });
                };

                const renderMarkdown = (text) => {
                    return marked.parse(text);
                };

                const setInput = (text) => {
                    input.value = text;
                    textarea.value.focus();
                };

                const handleFileUpload = (event) => {
                    const files = Array.from(event.target.files);
                    attachments.value = [...attachments.value, ...files];
                };

                const removeAttachment = (index) => {
                    attachments.value.splice(index, 1);
                };

                const sendMessage = async () => {
                    if (!input.value.trim() && attachments.value.length === 0) return;

                    const userMsg = { 
                        role: 'user', 
                        content: input.value,
                        attachments: attachments.value
                    };
                    
                    messages.value.push(userMsg);
                    const prompt = input.value;
                    input.value = '';
                    attachments.value = [];
                    textarea.value.style.height = 'auto';
                    scrollToBottom();

                    isTyping.value = true;

                    // SIMULATE BACKEND RESPONSE (Replace with actual API call)
                    setTimeout(() => {
                        isTyping.value = false;
                        
                        let responseContent = "I can help with that. Here is a sample analysis:\n\n";
                        responseContent += "```python\ndef analyze_data(data):\n    return data.describe()\n```";
                        
                        // Simulate artifact generation if code is involved
                        if (prompt.toLowerCase().includes('react') || prompt.toLowerCase().includes('html')) {
                            showArtifacts.value = true;
                            currentArtifact.value = `
                                <html><body style="font-family:sans-serif; padding:20px; color:#333;">
                                    <h1 style="color:#2563eb">Dashboard Preview</h1>
                                    <div style="background:#f3f4f6; padding:20px; border-radius:8px; margin-top:10px;">
                                        <h3>Stats</h3>
                                        <p>Users: 1,234 (+12%)</p>
                                    </div>
                                </body></html>
                            `;
                        }

                        messages.value.push({
                            role: 'assistant',
                            content: responseContent,
                            tools: [{ name: 'code_interpreter', status: 'success' }]
                        });

                        nextTick(() => {
                            Prism.highlightAll();
                            scrollToBottom();
                            lucide.createIcons();
                        });

                    }, 1500);
                };

                const startNewChat = () => {
                    messages.value = [];
                    activeChatId.value = null;
                    showArtifacts.value = false;
                    currentArtifact.value = null;
                };
                
                const loadChat = (id) => {
                    activeChatId.value = id;
                    // Load mock messages
                    messages.value = [
                        { role: 'user', content: 'History message example ' + id },
                        { role: 'assistant', content: 'This is a loaded chat history.' }
                    ];
                    nextTick(() => {
                        Prism.highlightAll();
                        scrollToBottom();
                    });
                };
                
                const deleteChat = (id) => {
                    history.value = history.value.filter(c => c.id !== id);
                    if (activeChatId.value === id) startNewChat();
                };

                onMounted(() => {
                    lucide.createIcons();
                    // Initial highlight
                    Prism.highlightAll();
                });

                return {
                    input, messages, isTyping, sendMessage, renderMarkdown,
                    messagesContainer, sidebarOpen, showArtifacts, currentArtifact,
                    attachments, handleFileUpload, removeAttachment,
                    showModelSelector, currentModel, models, setInput,
                    history, activeChatId, startNewChat, loadChat, deleteChat, textarea
                };
            }
        }).mount('#app');
    </script>
</body>
</html>